extends layout

block content
  h2 Asset Category Master
  link(rel="stylesheet", href="/css/delete.css")
  // Add New Category Button
  a(href="/category/create" class="btn btn-primary mb-3") Add New Asset Category

  // Filter Form
  form#filterForm
    input(type="text" name="name" placeholder="Search by Name" class="form-control mb-3")
    button(type="submit" class="btn btn-primary") Apply Filters

  // Asset Categories Table
  table#categoryTable.table.table-striped.table-bordered
    thead
      tr
        th Name
        th Description
        th Actions
    tbody
      if categories && categories.length > 0
        each category in categories
          tr
            td= category.name
            td= category.description
            td
              a(href=`/categories/${category.id}/edit` class="btn btn-warning btn-sm mr-2") Edit
              button(type="button" class="btn btn-danger btn-sm delete-btn" data-id=`${category.id}`) Delete
      else
        tr
          td(colspan="3" class="text-center") No categories found

  // Modal for confirmation
  .modal#deleteModal
    .modal-content
      .modal-header
        h5.modal-title Confirm Deletion
        button(type="button" class="close" onclick="closeModal()") Ã—
      .modal-body
        p Are you sure you want to delete this asset category?
      .modal-footer
        button(type="button" class="btn btn-secondary" onclick="closeModal()") Cancel
        button(type="button" id="confirmDelete" class="btn btn-danger") Confirm Delete

block scripts
  // Include DataTables CSS and JS
  link(rel="stylesheet", href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css")
  script(src="https://code.jquery.com/jquery-3.6.0.min.js")
  script(src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js")
  
  // Initialize DataTable on the table
  script.
    $(document).ready(function() {
      $('#categoryTable').DataTable({
        paging: true,      
        searching: true,   
        ordering: true,    
        info: true,        
        lengthMenu: [5, 10, 25, 50],
        language: {
          search: "_INPUT_",
          searchPlaceholder: "Search by name"
        }
      });

      
      $(document).on("click", ".delete-btn", function() {
          const categoryId = $(this).data("id");
          $("#confirmDelete").data("category-id", categoryId);
          showModal(); // Show the modal
      });

     
      $("#confirmDelete").on("click", function() {
          const categoryId = $(this).data("category-id");

          $.ajax({
              url: `/categories/${categoryId}/delete`,
              type: "DELETE",
              success: function(response) {
                  console.log(response.message);
                  closeModal(); 
                  location.reload();
              },
              error: function(err) {
                  console.error(err.responseJSON.error);
                  alert("Error deleting category");
              }
          });
      });
    });

  // Function to show the modal
  script.
    function showModal() {
        document.getElementById('deleteModal').style.display = 'block';
    }

  // Function to close the modal
  script.
    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }
