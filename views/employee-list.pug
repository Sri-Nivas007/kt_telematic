extends layout

block content
  h2 Employee List
    // Add a button to navigate to the 'create employee' page
  a(href='/employees/create' class="btn btn-primary mb-3") Add New Employee
  link(rel="stylesheet", href="/css/delete.css")
  table#employeeTable.table.table-striped
    thead
      tr
        th Name
        th Job Title
        th Status
        th Actions
    tbody
      each employee in employees
        tr
          td= employee.name
          td= employee.job_title
          td= employee.status ? "Active" : "Inactive"
          td
            a(href=`/employees/${employee.id}/edit` class="btn btn-warning btn-sm") Edit
            button(type="button" class="btn btn-danger btn-sm delete-btn" data-id=`${employee.id}`) Delete

  // Modal for confirmation (using custom CSS)
  .modal#deleteModal
    .modal-content
      .modal-header
        h5.modal-title Confirm Deletion
        button(type="button" class="close" onclick="closeModal()") Ã—
      .modal-body
        p Are you sure you want to delete this employee?
      .modal-footer
        button(type="button" class="btn btn-secondary" onclick="closeModal()") Cancel
        button(type="button" id="confirmDelete" class="btn btn-danger") Confirm

block scripts
  script.
    $(document).ready(function() {
        // Initialize DataTable
        $('#employeeTable').DataTable();

        // Handle delete button click
        $(document).on("click", ".delete-btn", function() {
            const employeeId = $(this).data("id");
            $("#confirmDelete").data("employee-id", employeeId); // Store the ID
            showModal(); // Show the custom modal
        });

        // Handle confirmation of delete
        $("#confirmDelete").on("click", function() {
            const employeeId = $(this).data("employee-id");

            $.ajax({
                url: `/employees/${employeeId}/delete`,
                type: "DELETE",
                success: function(response) {
                    console.log(response.message);
                    closeModal(); // Hide the modal
                    location.reload(); // Reload the page after deletion
                },
                error: function(err) {
                    console.error(err.responseJSON.error);
                    alert("Error deleting employee");
                }
            });
        });
    });

    // Function to show the modal
    function showModal() {
        document.getElementById('deleteModal').style.display = 'block';
    }

    // Function to close the modal
    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }
