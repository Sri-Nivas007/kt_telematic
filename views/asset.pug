extends layout

block content
  h2 Asset Master
  link(rel="stylesheet", href="/css/delete.css")
  
  // Add New Asset Button
  a(href="/asset/create" class="btn btn-primary mb-3") Add New Asset

  form#filterForm
    input(type="text" name="serial_number" placeholder="Search by Serial Number")
    input(type="text" name="make" placeholder="Search by Make")
    input(type="text" name="model" placeholder="Search by Model")
    input(type="number" name="min_price" placeholder="Min Price")
    input(type="number" name="max_price" placeholder="Max Price") 
    
    select(name="categoryType")
      option(value="") Select Category
      // Check if categories exist
      if categories && categories.length
        // Loop through the categories to generate the options dynamically
        each category in categories
          option(value=category.id)= category.name
      else
        option(value="") No Categories Available

    select(name="branchId")
      option(value="") Select Branch
      // Check if branches exist
      if branches && branches.length
        // Loop through the branches to generate the options dynamically
        each branch in branches
          option(value=branch.id)= branch.name
      else
        option(value="") No Branches Available

    button(type="submit") Apply Filters

  table#assetTable.table.table-striped
    thead
      tr
        th Serial Number
        th Make
        th Model
        th Description
        th Category
        th Status
        th Branch
        th Price 
        th Actions
    tbody
      if assets && assets.length
        each asset in assets
          tr
            td= asset.serial_number
            td= asset.make
            td= asset.model
            td= asset.description || 'No Description'
            td= asset.category ? asset.category.name : 'No Category'
            td= asset.status
            td= asset.branch ? asset.branch : 'No Branch'
            td= asset.price ? `$${asset.price.toFixed(2)}` : 'N/A' 
            td
              a(href=`/asset/${asset.id}/edit` class="btn btn-warning btn-sm") Edit
              button(type="button" class="btn btn-danger btn-sm delete-btn" data-id=`${asset.id}`) Delete
      else
        tr
          td(colspan="9") No assets found.

  // Modal for confirmation
  .modal#deleteModal
    .modal-content
      .modal-header
        h5.modal-title Confirm Deletion
        button(type="button" class="close" onclick="closeModal()") Ã—
      .modal-body
        p Are you sure you want to delete this asset?
      .modal-footer
        button(type="button" class="btn btn-secondary" onclick="closeModal()") Cancel
        button(type="button" id="confirmDelete" class="btn btn-danger") Confirm

block scripts
  script.
    $(document).ready(function() {
        // Initialize DataTable
        $('#assetTable').DataTable();

        // Handle delete button click
        $(document).on("click", ".delete-btn", function() {
            const assetId = $(this).data("id");
            $("#confirmDelete").data("asset-id", assetId); // Store the ID
            showModal(); // Show the custom modal
        });

        // Handle confirmation of delete
        $("#confirmDelete").on("click", function() {
            const assetId = $(this).data("asset-id");

            $.ajax({
                url: `/asset/${assetId}/delete`,
                type: "DELETE",
                success: function(response) {
                    console.log(response.message);
                    closeModal(); // Hide the modal
                    location.reload(); // Reload the page after deletion
                },
                error: function(err) {
                    console.error(err.responseJSON.error);
                    alert("Error deleting asset");
                }
            });
        });

        // Handle filtering
        $('#filterForm').on('submit', function(event) {
            event.preventDefault();
            const filters = $(this).serialize();
            window.location.href = '/assets?' + filters;
        });
    });

    
    function showModal() {
        document.getElementById('deleteModal').style.display = 'block';
    }

   
    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }
